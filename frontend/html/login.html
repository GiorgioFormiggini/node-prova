<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TMDB Clone - Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./css/styles.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#3b82f6',
                        'accent': '#10b981',
                        'dark-bg': '#0d1117',
                        'card-bg': '#1f2937',
                    },
                }
            }
        }
    </script>
</head>

<body class="bg-dark-bg min-h-screen flex items-center justify-center p-4">

    <!-- Card di Login -->
    <div class="w-full max-w-md bg-card-bg p-8 rounded-2xl shadow-2xl border border-gray-700">
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-primary mb-2">Accedi al tuo account</h2>
            <p class="text-gray-400">Inserisci le tue credenziali per continuare</p>
        </div>

        <!-- Form di Login -->
        <form id="login-form">
            <div class="mb-5">
                <label for="email" class="block text-sm font-medium text-gray-300 mb-2">Email</label>
                <input type="email" id="email" name="email" required placeholder="tua.email@esempio.com"
                    class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg focus:ring-primary focus:border-primary text-gray-100 transition duration-300" />
            </div>
            <div class="mb-6">
                <label for="password" class="block text-sm font-medium text-gray-300 mb-2">Password</label>
                <input type="password" id="password" name="password" required placeholder="********"
                    class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg focus:ring-primary focus:border-primary text-gray-100 transition duration-300" />
            </div>

            <!-- Pulsante di Login -->
            <button type="submit" id="login-btn"
                class="w-full bg-primary text-white p-3 rounded-xl font-semibold text-lg hover:bg-blue-600 transition duration-300 shadow-md hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-primary/50 active:scale-[0.98] mt-4">
                Accedi
            </button>

            <script>
            document.getElementById('login-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const form = e.target;
                const formData = Object.fromEntries(new FormData(form));
                // Send email and password to backend for server-side validation
                const payload = { email: formData.email, password: formData.password };

                try {
                    const res = await fetch('/api/auth/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const json = await res.json().catch(() => ({ success: false }));

                    if (res.ok && json.token) {
                        localStorage.setItem('token', json.token);
                        window.location.href = 'home.html';
                    } else {
                        showToast(json.message || 'Credenziali non valide', 'error');
                    }
                } catch (err) {
                    console.error(err);
                    showToast('Impossibile eseguire il login. Riprova.', 'error');
                }
            });
            </script>
        </form>

        <!-- Link per la registrazione -->
        <div class="text-center mt-6">
            <p class="text-gray-400">Non hai un account? <a href="signup.html"
                    class="text-primary hover:text-accent font-medium transition duration-300">Registrati qui</a></p>
        </div>
    </div>

    <script type="module" src="./js/auth.js"></script>
    <script type="module" src="./js/ui.js"></script>
    <script type="module" src="./js/main.js"></script>
    <script src="./js/toast.js"></script>
    <script>
    // Simple logout button wiring
    document.addEventListener('DOMContentLoaded', () => {
        const logout = document.getElementById('logout-button');
        if (!logout) return;
        logout.addEventListener('click', () => {
            localStorage.removeItem('token');
            window.location.href = 'index.html';
        });
    });
    </script>
</body>

</html>